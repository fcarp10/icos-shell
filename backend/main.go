/*
 * ICOS Shell
 *
 * This is the ICOS Shell based on the OpenAPI 3.0 specification.
 *
 * API version: 1.0.11
 * Generated by: OpenAPI Generator (https://openapi-generator.tech)
 */

package main

import (
	"flag"
	"fmt"
	"log"
	"net/http"
	"os"
	shellbackend "shellbackend/go"

	"github.com/spf13/viper"
)

func main() {

	cfgFile := flag.String("config", "config.yml", "config file")
	flag.Parse()
	cfgFileString := *cfgFile

	viper.SetConfigFile(cfgFileString)
	if err := viper.ReadInConfig(); err == nil {
		fmt.Fprintln(os.Stderr, "Config:", viper.ConfigFileUsed())
	} else {
		fmt.Fprintln(os.Stderr, "Config file not found!")
	}

	log.Printf("Backend service starting...")

	ControllerApiService := shellbackend.NewControllerAPIService()
	ControllerApiController := shellbackend.NewControllerAPIController(ControllerApiService)

	DefaultApiService := shellbackend.NewDefaultApiService()
	DefaultApiController := shellbackend.NewDefaultAPIController(DefaultApiService)

	DeploymentApiService := shellbackend.NewDeploymentAPIService()
	DeploymentApiController := shellbackend.NewDeploymentAPIController(DeploymentApiService)

	ResourceApiService := shellbackend.NewResourceAPIService()
	ResourceApiController := shellbackend.NewResourceAPIController(ResourceApiService)

	UserApiService := shellbackend.NewUserAPIService()
	UserApiController := shellbackend.NewUserAPIController(UserApiService)

	router := shellbackend.NewRouter(ControllerApiController, DefaultApiController, DeploymentApiController, ResourceApiController, UserApiController)

	log.Fatal(http.ListenAndServe(":8080", router))
}
